<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>樋口</title>
    <meta name="description" content="WebVR - Aframe - VR walkthrough">
    <meta name="author" content="Kumar Ahir - VR Designer">

    <!-- 変更：キャッシュバスト用のバージョン -->
<script>window.ASSET_VER = '20251008_01';</script>

     <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-animation-component@3.2.1/dist/aframe-animation-component.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script>
      AFRAME.registerComponent('hotspots',{
        init:function(){
            this.el.addEventListener('reloadspots',function(evt){
            
            //get the entire current spot group and scale it to 0
            var currspotgroup=document.getElementById(evt.detail.currspots);
            currspotgroup.setAttribute("scale","0 0 0");
            
            //get the entire new spot group and scale it to 1
            var newspotgroup=document.getElementById(evt.detail.newspots);
            newspotgroup.setAttribute("scale","1 1 1");
          });
        }
      });
      AFRAME.registerComponent('spot',{
        schema:{
          linkto:{type:"string",default:""},
          spotgroup:{type:"string",default:""}
        },
        init:function(){
          
          //add image source of hotspot icon
          this.el.setAttribute("src","#hotspot");
          //make the icon look at the camera all the time
          this.el.setAttribute("look-at","#cam");
          

          //   - on: mouseenter … 重なった瞬間に1回だけ再生
          //   - positional: false … UI効果音としてスピーカー中央から鳴る
          //   - volume: 適宜調整（0.0 - 1.0）
          this.el.setAttribute('sound', 'src: #hover; on: mouseenter; positional: false; volume: 0.8');


          var data=this.data;
          
          this.el.addEventListener('click',function(){
            //set the skybox source to the new image as per the spot
            var sky=document.getElementById("skybox");
            sky.setAttribute("src",data.linkto);
            
            var spotcomp=document.getElementById("spots");
            var currspots=this.parentElement.getAttribute("id");
            //create event for spots component to change the spots data
            spotcomp.emit('reloadspots',{newspots:data.spotgroup,currspots:currspots});
          });
        }
      });
    </script>

<!-- 画像のプリロード完了を待ってから表示（チラつき/真っ黒防止） -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const scene = document.querySelector('a-scene');
    const assets = document.querySelector('a-assets');
    function ready(){ scene.renderer && (scene.style.visibility='visible'); }
    scene.style.visibility = 'hidden';
    if (assets && assets.hasLoaded) { ready(); }
    else { assets && assets.addEventListener('loaded', ready); }
  });
</script>

<!-- ▼ ここに追記：AudioContext解錠スクリプト -->
<script>
  (function () {
    let unlocked = false;
    function unlockAudio() {
      if (unlocked) return;
      unlocked = true;

      // A-Frame / three.js の AudioContext を再開
      const ctx = (AFRAME.audioContext ||
                  (AFRAME.THREE && AFRAME.THREE.AudioContext &&
                   AFRAME.THREE.AudioContext.getContext && AFRAME.THREE.AudioContext.getContext()));
      if (ctx && ctx.state !== 'running' && ctx.resume) {
        try { ctx.resume(); } catch(e) {}
      }

      // 解錠の実弾：hover音を一瞬だけ鳴らして停止
      const hoverTarget = document.querySelector('[sound][src="#hover"]');
      try {
        if (hoverTarget && hoverTarget.components && hoverTarget.components.sound) {
          hoverTarget.components.sound.playSound();
          setTimeout(() => hoverTarget.components.sound.stopSound(), 50);
        } else {
          const audio = document.getElementById('hover');
          if (audio && audio.play) {
            audio.play().then(() => { audio.pause(); audio.currentTime = 0; }).catch(()=>{});
          }
        }
      } catch(e){}

      window.removeEventListener('click', unlockAudio, true);
      window.removeEventListener('touchstart', unlockAudio, true);
    }
    window.addEventListener('click', unlockAudio, true);
    window.addEventListener('touchstart', unlockAudio, true);
  })();
</script>
<!-- ▲ 追記ここまで -->







  </head>
  <body>
    
    
    
    <a-scene background="color: #ECECEC">
   
      
      <a-assets>
        <!-- エントランス -->
        <img id="point1"  crossorigin="anonymous" src="https://isononatsumikan.github.io/assets/010.jpg?v=20251008_02">
        <!-- １F客席 -->
        <img id="point2"  crossorigin="anonymous" src="https://isononatsumikan.github.io/assets/007.jpg?v=20251008_02">
        <!-- キッチン -->
        <img id="point3"  crossorigin="anonymous" src="https://isononatsumikan.github.io/assets/008.jpg?v=20251008_02">
        <!-- 2F階段 -->
        <img id="point4"  crossorigin="anonymous" src="https://isononatsumikan.github.io/assets/021.jpg?v=20251008_02">
        <!-- 2F客席１ -->
        <img id="point5"  crossorigin="anonymous" src="https://isononatsumikan.github.io/assets/009.jpg?v=20251008_02">
        <!-- 1F客席窓際 -->
        <img id="point6"  crossorigin="anonymous" src="https://isononatsumikan.github.io/assets/024.jpg?v=20251008_02">
        <!-- 1F客席中央 -->
        <img id="point7"  crossorigin="anonymous" src="https://isononatsumikan.github.io/assets/001.jpg?v=20251008_02">
        <!-- 2F客席２-中央 -->
        <img id="point8"  crossorigin="anonymous" src="https://isononatsumikan.github.io/assets/004.jpg?v=20251008_02">
        <!-- 2F客席３-窓際 -->
        <img id="point9"  crossorigin="anonymous" src="https://isononatsumikan.github.io/assets/015.jpg?v=20251008_02">
        <!-- 1F入口ポーチ -->
        <img id="point10" crossorigin="anonymous" src="https://isononatsumikan.github.io/assets/005.jpg?v=20251008_02">
        <!-- 入口ファサード -->
        <img id="point11" crossorigin="anonymous" src="https://isononatsumikan.github.io/assets/020.jpg?v=20251008_02">
        <!-- アイコン -->
        <img id="hotspot" crossorigin="anonymous" src="https://isononatsumikan.github.io/assets/arrow.png?v=20251008_02">
        
        <!-- サウンド -->
        <audio id="hover" src="https://isononatsumikan.github.io/assets/hover.mp3?v=20251008_02" preload="auto" playsinline></audio>
      
      </a-assets>
      
      
      <a-entity id="spots" hotspots>
        
        <!-- エントランス　point1-->
        <a-entity id="group-point1">
          <!-- １F客席へ-->
          <a-image spot="linkto:#point2;spotgroup:group-point2" position="-4 -1 0"></a-image>
          <!-- キッチンへ-->
          <a-image spot="linkto:#point3;spotgroup:group-point3" position="0 -0.5 4"></a-image>
          <!-- 2Fへ-->
          <a-image spot="linkto:#point4;spotgroup:group-point4" position="-2.3 2 -4"></a-image>
          <!-- 入口ポーチへ-->
          <a-image spot="linkto:#point10;spotgroup:group-point10" position="0 -1 -2"></a-image>         
        </a-entity>
        
        <!-- １F客席　point2-->
        <a-entity id="group-point2" scale="0 0 0">
          <!-- エントランスに戻る -->
          <a-image spot="linkto:#point1;spotgroup:group-point1" position="3 -1 0"></a-image>
          <!-- キッチンへ-->
          <a-image spot="linkto:#point3;spotgroup:group-point3" position="1.5 1 3.5"></a-image>
          <!-- 客席窓際へ-->
          <a-image spot="linkto:#point6;spotgroup:group-point6" position="-0.2 -1 -2.5"></a-image>
          <!-- 客席中央へ-->
          <a-image spot="linkto:#point7;spotgroup:group-point7" position="-3 -1 0.5"></a-image>
        </a-entity>
        
        <!-- キッチン　point3-->
        <a-entity id="group-point3" scale="0 0 0">
          <!-- エントランスに戻る-->
          <a-image spot="linkto:#point1;spotgroup:group-point1" position="-0.2 0 -3"></a-image>
          <!-- 2Fへ-->
          <a-image spot="linkto:#point4;spotgroup:group-point4" position="-1.3 2 -4"></a-image>
        </a-entity>
        
        <!-- 2F階段　point4-->
        <a-entity id="group-point4" scale="0 0 0">
          <!-- 2F客席へ-->
          <a-image spot="linkto:#point5;spotgroup:group-point5" position="-0.6 0 3"></a-image>
          <!-- 1Fへ-->
          <a-image spot="linkto:#point1;spotgroup:group-point1" position="-1.8 -1 0"></a-image>
        </a-entity>
        
        <!-- 2F客席１　point5-->
        <a-entity id="group-point5" scale="0 0 0">
          <!-- 2F客席２へ-->
          <a-image spot="linkto:#point8;spotgroup:group-point8" position="-2 0 0"></a-image>
          <!-- 階段へ-->
          <a-image spot="linkto:#point4;spotgroup:group-point4" position="0.5 0 -3"></a-image>
        </a-entity>
        
        
      　<!-- 1F客席窓際　point6-->
        <a-entity id="group-point6" scale="0 0 0">
       　　<!-- １F客席へ戻る-->
          <a-image spot="linkto:#point2;spotgroup:group-point2" position="0.2 -1 3"></a-image>
        </a-entity>
        
        <!-- 1F客席中央　point7-->
        <a-entity id="group-point7" scale="0 0 0">
       　　<!-- １F客席へ戻る-->
          <a-image spot="linkto:#point2;spotgroup:group-point2" position="3 -1 -0.3"></a-image>
        </a-entity>
        
        <!-- 2F客席中央2　point8-->
        <a-entity id="group-point8" scale="0 0 0">
       　　<!-- 2F客席３-窓際へ -->
          <a-image spot="linkto:#point9;spotgroup:group-point9" position="0 0 -2"></a-image>
          <!-- 2F客席1へ-->
          <a-image spot="linkto:#point5;spotgroup:group-point5" position="3 0 0.7"></a-image>
        </a-entity>  
        
        <!-- 2F客席３-窓際　point9-->
        <a-entity id="group-point9" scale="0 0 0">
       　　<!-- 2F客席２へ -->
          <a-image spot="linkto:#point8;spotgroup:group-point8" position="0 0 2"></a-image>
        </a-entity> 
        
        <!-- 入口ポーチ　point10-->
        <a-entity id="group-point10" scale="0 0 0">
          <!-- エントランスに戻る -->
          <a-image spot="linkto:#point1;spotgroup:group-point1" position="-0.2 0 2"></a-image>
          <!-- 入口ファサードへ -->
          <a-image spot="linkto:#point11;spotgroup:group-point11" position="0.2 0 -1.8"></a-image>
        </a-entity>
        
        <!-- 入口ファサード　point11-->
        <a-entity id="group-point11" scale="0 0 0">
          <!-- 入口ポーチに戻る -->
          <a-image spot="linkto:#point10;spotgroup:group-point10" position="-0.2 0 2"></a-image>
        </a-entity>
        
      </a-entity>
      
      
      <!-- デバッグ用：今このHTMLが新しいか即判定できる帯 -->
      <div style="position:fixed;left:0;right:0;bottom:0;background:#222;color:#fff;padding:.4rem .8rem;font:12px/1.2 sans-serif;opacity:.85;z-index:99999">
      build: <script>document.write(window.ASSET_VER)</script> /
       time: <script>document.write(new Date().toLocaleString())</script>
      </div>
      
      
      <!-- 変更：半径拡大で“真っ白”見えを回避しやすく -->
      <a-sky id="skybox" radius="5000" src="#point1"></a-sky>
      
       <a-text position="-1 1.6 -3" value="Hover red circle over arrow" color="#008080" font="kelsonsans"></a-text>
      
      <a-entity id="cam" camera position="0 1.6 0" look-controls>
        <a-entity cursor="fuse:true;fuseTimeout:2000"
                  geometry="primitive:ring;radiusInner:0.01;radiusOuter:0.02"
                  position="0 0 -1.8"
                  material="shader:flat;color:#ff0000"
                  animation__mouseenter="property:scale;to:3 3 3;startEvents:mouseenter;endEvents:mouseleave;dir:reverse;dur:2000;loop:1">
        </a-entity>
      </a-entity>
      
    </a-scene>
  </body>
</html>